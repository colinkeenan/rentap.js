html(lang='en')
  head
    title Rental Application
    meta(charset='utf-8')
    meta(name='viewport', content='width=device-width, initial-scale=1')
    link(rel='shortcut icon' href='/images/icon.png')
    link(rel='stylesheet' media='print' href='/stylesheets/rentap-print.css')
    link(rel='stylesheet' media='screen' href='/stylesheets/rentap-screen.css')
  body

    //- The form action is the current url by default, and the method is 'get' by default
    //- I am just using the default for many buttons.
    //- 
    //- However, buttons (which are of type submit by default) can have
    //- formaction='/path' and the same can be done with method, 
    //- formmethod='post'
    //- all the get buttons will be distinguished by path (in rentapRoutes), so will use formaction='/path' for all get buttons
    //- all the post buttons will have name 'button' and will be distinguished by value. there will only be one controller method
    //- for all post buttons
    form#rentap 
      //- the model has access to headers table as headers[{StreetAddress, CityStateZip, Title, Name}, etc.]
      //- headerform expects the following variables from get headername, (header will be undefined for get new header) 
      
      //- header: {StreetAddress, CityStateZip, Title, Name}, headerNames[name1,...], 

      //- where header from headers is chosen by tbl.headerName = headers.Name
      table#rentapheader 
        tr 
          td 
            img(src='/images/icon.png')

          td 
            input#rentaladdress(type='text' value=(undefined===header ? 'enter rental address' : header.StreetAddress)) 
            input#rentalcitystzip(type='text' value=(undefined===header ? 'enter city, state, zip' : header.CityStateZip))

          td#tdrtitle 
            input#mode.inlineshort(type='text' readonly value=(undefined===mode ? 'new' : mode)) 
            input#rtitle(type='text' value=(undefined===header ? 'enter title' : header.Title))

          td 
            label.smalllabel(for='authdate') Applied 
            input#authdate(type='text' value=(undefined===ap ? '' : ap.dateApplied)) 
            div(style='font: 12px/14px sans-serif; display:inline; position: relative; top: -10px;') Row: 
            
            input#rowprint(type='text' value=(undefined===rownum? '' : rownum) readonly) 
            br 
            div(style='font: 12px/14px sans-serif; display:inline; position: relative; top: -10px;') ID: 
            input#rentapID(type='text' value=(undefined===ap? '' : ap.rowid) readonly) 
            
          td
            label.smalllabel(for='guestdate') Guest 
            - var rentapDateGuested = undefined===ap ? '' : ap.dateGuested
            textarea#guestdate(cols='8' rows='2')= rentapDateGuested

          td
            label.smalllabel(for='rentdate') Rented 
            - var rentapDateRented = undefined===ap? '' : ap.dateRented
            textarea#rentdate(cols='8' rows='2')= rentapDateRented

          td#headercontrols 
            //- value of input#headername changes when select#changeHeadername changes
            input#headername.inline(type='text' value=(undefined===header ? '' : header.Name)) 
            //- res.render in controller will provide url: req.originalUrl along with header.headerName etc. formaction needs to preserve the current route
            //- in order to keep displaying the same page as user changes header. the buttons just have one character on them (+, ~, -)
            //- except the default header button has ->0
            //- saveheader and editheader both save, but one inserts new and the other updates existing
            //- they are both post buttons, so will name them both the same (saveHeader) and distinguish by the value of saveHeader
            //- given by form.body.saveHeader, it will either be 'new' or 'existing'
            button#saveheader.inline(title='Save New Header' name='button' value='newheader' formmethod='post') +
            button#editheader.inline(title='Save Edited Header' name='button' value='existingheader' formmethod='post') ~
            button#delheader.inline(title='Delete Header' formaction=url + '/header/delete/' + header.headerName) -
            //- seems like this is how to put the dropdown list on the page using Pug
            //- onchange... makes hidden input#rentapHeadername update to match whatever is selected
            //- and then submits the header form to update header (which includes input#headername above)
            //- (I can't figure out how I did it in the rentap extension though)
            if (headerNames)
              select#changeHeadername(name='button' onchange='rentap.submit()')
                each headerName in headerNames
                  option(value=headerName selected=(header.Name === headerName)) headerName
            button#defaultheader.inline(title='Set as default header shown on start' formaction=url + '/header/default/' + header.headerName) ->0
    div
      //- this form should receive one rentap from 
      //- rentaps[{FullName, SSN, BirthDate, MaritalStatus, Email, StateID, Phone1, Phone2, CurrentAddress, PriorAddresses, ProposedOccupants, ProposedPets, Income, Employment, Evictions, Felonies, dateApplied, dateGuested, dateRented, headerName}, ...], 
      //- rowmode{row,mode} and the ap.rowid=tbl.rowid of the rentap to display

      //- For a new ap, ap.rowid rentap and rowmode will all be undefined

      //- hidden input below is set by changeInputHeadername above when select#changeHeadername is changed
      table#rentapbody 
        tr 
          td 
            ul 
              li.section_header Personal Information

              li
                label.personalinfo(for='fullname') Full Name 
                input#fullname(type='text' value=(undefined===ap? '' : ap.FullName))

              li 
                label.personalinfo(for='ssnumber') Social Security Number 
                input#ssnumber(type='text' value=(undefined===ap? '' : ap.SSN))

              li 
                label.personalinfo(for='birthdate') Birth Date 
                input#birthdate(type='text' value=(undefined===ap? '' : ap.BirthDate))

              li 
                label.personalinfo(for='maritalstatus') Marital Status 
                input#maritalstatus(type='text' value=(undefined===ap? '' : ap.MaritalStatus))

              li 
                label.personalinfo(for='email') Email 
                input#email(type='text' value=(undefined===ap? '' : ap.Email))

              li 
                label.personalinfo(for='stateid') State ID# 
                input#stateid(type='text' value=(undefined===ap? '' : ap.StateID))

              li 
                label.personalinfo(for='phone1') Phone 1 
                input#phone1(type='text' value=(undefined===ap? '' : ap.Phone1))

              li 
                label.personalinfo(for='phone2') Phone 2 
                input#phone2(type='text' value=(undefined===ap? '' : ap.Phone2))

              li 
                - var ca = undefined===ap ? '' : ap.CurrentAddress
                label#currentaddresslabel(for='currentaddress') #[strong Current Address, City, State, Zip, Dates, Rent, Landlord name and phone number]...  
                textarea#currentaddress= ca

              li 
                - var pa = undefined===ap ? '' : ap.PriorAddresses
                label(for='previousaddresses') #[strong Prior Addresses, Cities, States, Zips, Dates, Rents, Landlords]...  
                textarea#previousaddresses= pa

          td 
            ul 
              li 
                - var po = undefined===ap ? '' : ap.ProposedOccupants
                label(for='occupants') #[strong Proposed Occupants: self+age, other+age]...  
                textarea#occupants= po

              li 
                - var pp = undefined===ap ? '' : ap.ProposedPets
                label(for='pets') #[<strong>Proposed Pets] 
                textarea#pets= pp

              li 
                - var inc = undefined===ap ? '' : ap.Income
                label(for='income') #[strong Income &amp Food Stamps] 
                textarea#income= inc

              li
                - var emp = undefined===ap ? '' : ap.Employment
                label(for='employment') #[strong Employment: address, job, dates, hours, supervisor name and phone number]... 
                textarea#employment= emp

          td
            ul
              li
                - var ev = undefined===ap ? '' : ap.Evictions
                label(for='evictions') #[strong Evictions Past 10 Years] 
                textarea#evictions= ev

              li
                - var fe = undefined===ap ? '' : ap.Felonies
                label(for='felonies') #[strong Felonies/Drug Convictions] 
                textarea#felonies= fe

          td#controls 
            ul 
              li 
                if (mode != 'discarded')
                  button#save.inline(name='button' value='save' formmethod='post') Save 
                  button#new.inline(formaction='/rentap') New 
                  button#discard.inline(formaction='/rentap/discard/' + (undefined===ap ? '' : ap.rowid)) Discard
                  button#trash.inline(formaction='/rentap/show/' + (undefined==ap ? '' : ap.rowid) + '/switch_mode') Trash
                else 
                  button#restore.inline(formaction='/rentap/restore/' + (undefined==ap ? '' : ap.rowid)) Restore
                  button#delrentap.inline(formaction='/rentap/delete/' + (undefined==ap ? '' : ap.rowid)) Delete
                  button#back.inline(formaction='/rentap/show/' + (undefined==ap ? '' : ap.rowid) + '/switch_mode') Back 

    div.right
      button#prev.inlinebutton(formaction='/rentap/show/' + (undefined==ap ? undefined : ap.rowid) + '/prev') Prev
      button#next.inlinebutton(formaction='/rentap/show/' + (undefined==ap ? undefined : ap.rowid) + '/next') Next

      label(for='row' style='text-align:right; font-weight: normal; margin-right: 1ch; vertical-align: middle') row
      input#row.inline(type='text' style='text-align: right;' value='')
      button#jump.inlinebutton(name='button' value='jump' formmethod='post') Go
      
      input#pattern(type='text' value='' )
      //- the pattern to search for is in the posted data (...body.pattern)
      //- this button will assume search is to be limited to goodaps or trashaps
      //- based on what the current ap is (available as search_form.params.ap_id)
      button#search.inlinebutton(title='Click while empty to clear previous search and list all names.' name='button' value='search' formmethod='post') Search
      //- listsearchmenu is not a button, but will act like a submit button when the value changes. The controller distinguishes
      //- which button did the submission according to the value of form.button, but there's not a set value for this on
      //- so controller will assume it's this if nothing else
      if (Names)
        select#listsearchmenu.inline(name='button' onchange='rentap.submit()')
          each Name in Names
            option(value=Name.ap.rowid selected=(ap.rowid === Name.ap.rowid)) Name.FullName
